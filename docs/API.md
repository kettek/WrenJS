<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [WrenVM][1]
    -   [Examples][2]
    -   [interpret][3]
        -   [Parameters][4]
        -   [Examples][5]
    -   [call][6]
        -   [Parameters][7]
        -   [Examples][8]
    -   [free][9]
    -   [addForeignMethod][10]
        -   [Parameters][11]
        -   [Examples][12]
    -   [addForeignClassMethods][13]
        -   [Parameters][14]
        -   [Examples][15]
    -   [ensureSlots][16]
        -   [Parameters][17]
    -   [getSlotCount][18]
    -   [getSlotType][19]
        -   [Parameters][20]
    -   [getSlotDouble][21]
        -   [Parameters][22]
    -   [setSlotDouble][23]
        -   [Parameters][24]
    -   [getSlotString][25]
        -   [Parameters][26]
    -   [setSlotString][27]
        -   [Parameters][28]
    -   [getSlotBytes][29]
        -   [Parameters][30]
    -   [setSlotBytes][31]
        -   [Parameters][32]
    -   [getSlotBool][33]
        -   [Parameters][34]
    -   [setSlotBool][35]
        -   [Parameters][36]
    -   [setSlotNull][37]
        -   [Parameters][38]
    -   [getSlotForeign][39]
        -   [Parameters][40]
    -   [setSlotNewForeign][41]
        -   [Parameters][42]
    -   [setSlotNewList][43]
        -   [Parameters][44]
    -   [getListCount][45]
        -   [Parameters][46]
    -   [getListElement][47]
        -   [Parameters][48]
    -   [insertInList][49]
        -   [Parameters][50]
    -   [getVariable][51]
        -   [Parameters][52]
    -   [getSlotHandle][53]
        -   [Parameters][54]
    -   [setSlotHandle][55]
        -   [Parameters][56]
    -   [makeCallHandle][57]
        -   [Parameters][58]
        -   [Examples][59]
    -   [releaseHandle][60]
        -   [Parameters][61]
    -   [collectGarbage][62]
    -   [abortFiber][63]
        -   [Parameters][64]
    -   [importFile][65]
        -   [Parameters][66]
        -   [Examples][67]
    -   [importFiles][68]
        -   [Parameters][69]
        -   [Examples][70]
-   [WrenJS][71]
    -   [newVM][72]
        -   [Parameters][73]
-   [LibraryWren][74]
    -   [WrenJS_errorFn][75]
        -   [Parameters][76]
    -   [WrenJS_writeFn][77]
        -   [Parameters][78]
    -   [WrenJS_getForeignMethod][79]
        -   [Parameters][80]
    -   [WrenJS_getForeignClassAllocator][81]
        -   [Parameters][82]
    -   [WrenJS_getForeignClassFinalizer][83]
        -   [Parameters][84]
    -   [WrenJS_isFileAvailable][85]
        -   [Parameters][86]
    -   [WrenJS_importFileFromVM][87]
        -   [Parameters][88]

## WrenVM

WrenVM provides an object-oriented interface to the underlying Wren VM.

### Examples

```javascript
WrenJS.addEventListener('ready', () => {
  var vm = WrenJS.newVM({
    writeFn: (text) => {
      console.log("stdout: %s", text)
    },
    errorFn: (type, module, line, message) => {
      console.log("stderr(%d): %s %d %s", type, module, line, message)
    }
  })
  vm.interpret("main", 'System.print("Hello, xorld!")')
  .then(result => {
    switch(result) {
      case WrenJS.RESULT_COMPILE_ERROR:
        console.log("Compilation error!")
        break
      case WrenJS.RESULT_RUNTIME_ERROR:
        console.log("Runtime error!")
        break
      case WrenJS.RESULT_SUCCESS:
        console.log("Success!")
        break
    }
    // vm.call(...), etc.
    vm.free()
  })
})
```

### interpret

Runs the VM interpreter in the given module space with the provided source.

#### Parameters

-   `module` **[string][89]** 
-   `source` **[string][89]** 

#### Examples

```javascript
vm.interpret('main', 'System.print("Hello, xorld!")').then(result => {
  // Handle result.
})
```

Returns **[Promise][90]** 

### call

Calls the given handle. This presumes Wren slots have been set up appropriately.

#### Parameters

-   `handle` **[number][91]** 

#### Examples

```javascript
vm.ensureSlots(2)
vm.getVariable("my_module", "myClass", 0)
var handle = vm.makeCallHandle("classMethod()")
vm.call(handle)
vm.releaseHandle(handle)
```

### free

Frees up the VM. You must call `releaseHandle` on all your handles first.

### addForeignMethod

Adds a foreign method to the VM.

#### Parameters

-   `module` **[string][89]** 
-   `className` **[string][89]** 
-   `isStatic` **bool** 
-   `signature` **[string][89]** 
-   `cb` **[function][92]** 

#### Examples

```javascript
vm.addForeignMethod("wren/ForeignClass", "ForeignClass", 0, "add(_,_)", function() {
  var a = vm.getSlotDouble(1)
  var b = vm.getSlotDouble(2)
  vm.setSlotDouble(0, a+b)
})
```

### addForeignClassMethods

Adds a foreign class allocator and finalizer.

#### Parameters

-   `module` **[string][89]** 
-   `className` **[string][89]** 
-   `allocator` **[function][92]** 
-   `finalizer` **[function][92]** 

#### Examples

```javascript
vm.addForeignClassMethods("wren/ForeignClass", "ForeignClass", function() {
  // Allocator
  vm.setSlotNewForeign(0, 0, 0)
}, function() {
  // Finalizer
})
```

### ensureSlots

Ensures that the VM has the defined amount of slots available for use.

#### Parameters

-   `count` **[number][91]** 

### getSlotCount

Gets the amount of slots currently used.

Returns **[number][91]** 

### getSlotType

Returns the WrenType stored in a given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[number][91]** 

### getSlotDouble

Returns a floating point number stored in a given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[number][91]** 

### setSlotDouble

Sets the given slot to the provided floating point number.

#### Parameters

-   `slot` **[number][91]** 
-   `value` **[number][91]** 

### getSlotString

Returns a string stored in the given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[string][89]** 

### setSlotString

Sets the given slot to the provided string.

#### Parameters

-   `slot` **[number][91]** 
-   `string` **[string][89]** 

### getSlotBytes

Returns a Uint8Array of bytes stored in the given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[Uint8Array][93]** 

### setSlotBytes

Sets the given slot to the provided TypedArray. Provided data will be converted to a Uint8Array.

#### Parameters

-   `slot` **[number][91]** 
-   `typedArray` **[TypedArray][94]** 

### getSlotBool

Returns the boolean value of a given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[boolean][95]** 

### setSlotBool

Sets the given slot to the provided boolean value.

#### Parameters

-   `slot` **[number][91]** 
-   `value` **[boolean][95]** 

### setSlotNull

Sets the given slot to null.

#### Parameters

-   `slot` **[number][91]** 

### getSlotForeign

Returns a foreign object from the provided slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[number][91]** 

### setSlotNewForeign

Sets the given slot to a new foreign object with an optional size for extra bytes storage.

#### Parameters

-   `slot` **[number][91]** 
-   `classSlot` **[number][91]** 
-   `size` **[number][91]** 

Returns **[number][91]** pointer to the extra bytes.

### setSlotNewList

Sets the given slot to a new list.

#### Parameters

-   `slot` **[number][91]** 

### getListCount

Returns the number of items in a list in the given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[number][91]** 

### getListElement

Moves an element from the given listSlot's index to target elementSlot.

#### Parameters

-   `listSlot` **[number][91]** 
-   `index` **[number][91]** 
-   `elementSlot` **[number][91]** 

### insertInList

Inserts the provided element in elementSlot into the index position in the list at slot.

#### Parameters

-   `slot` **[number][91]** 
-   `index` **[number][91]** 
-   `elementSlot` **[number][91]** 

### getVariable

Gets a variable of the provided name in a module and sets it to the given slot.

#### Parameters

-   `module` **[string][89]** 
-   `name` **[string][89]** 
-   `slot` **[number][91]** 

### getSlotHandle

Returns the handle in the given slot.

#### Parameters

-   `slot` **[number][91]** 

Returns **[number][91]** 

### setSlotHandle

Sets the given slot to the given handle.

#### Parameters

-   `slot` **[number][91]** 
-   `handle` **[number][91]** 

### makeCallHandle

Creates and returns a handle that is usable in functions such as `call(handle)`.
You must call `releaseHandle(handle)` before you free the VM.

#### Parameters

-   `signature` **[string][89]** 

#### Examples

```javascript
vm.ensureSlots(2)
vm.getVariable("my_module", "myClass", 0)
var handle = vm.makeCallHandle("foreignMethod()")
vm.call(handle)
vm.releaseHandle(handle)
```

Returns **[number][91]** 

### releaseHandle

Release the given handle from the VM.

#### Parameters

-   `handle` **[number][91]** 

### collectGarbage

Calls the VM's garbage collection routine.

### abortFiber

Aborts the fiber.

#### Parameters

-   `slot` **[number][91]** 

### importFile

Loads a given file via XHR and adds it to the importedFiles map.
Must be called before interpreting.
Does nothing if WrenJS+ was built with DISABLE_JSVM_IMPORT.

#### Parameters

-   `file` **[string][89]** 

#### Examples

```javascript
vm.importFile("wren/testImport.wren")
.then(result => {
  vm.interpret(...)
})
```

Returns **[Promise][90]** 

### importFiles

Calls importFile(...) on an array of strings.

#### Parameters

-   `files` **[Array][96]&lt;[string][89]>** 

#### Examples

```javascript
vm.importFiles(["wren/testImport.wren", "wren/testImport2.wren"])
.then(result => {
  vm.interpret(...)
})
```

Returns **[Promise][90]** 

## WrenJS

WrenJS is the interface through which Wren VMs are created. Be aware that this is actually an Emscripten Module.
See [preamble.js][97] for additional information.

### newVM

-   **See: WrenVM**

Creates and returns a new WrenVM instance.

#### Parameters

-   `config` **[object][98]** Provides a config object that can contain errorFn and/or writeFn.

Returns **[WrenVM][99]** 

## LibraryWren

LibraryWren provides the JavaScript functions available to C.

### WrenJS_errorFn

Provides the C to WrenJS to WrenVM interface for handling Wren's error function.

#### Parameters

-   `id` **[number][91]** 
-   `type` **[number][91]** 
-   `module` **[string][89]** 
-   `line` **[number][91]** 
-   `message` **[string][89]** 

### WrenJS_writeFn

Provides the C to WrenJS to WrenVM interface for handling Wren's write function.

#### Parameters

-   `id` **[number][91]** 
-   `text` **[string][89]** 

### WrenJS_getForeignMethod

Returns a VM's foreign method to C.

#### Parameters

-   `id` **[number][91]** 
-   `module` **[string][89]** 
-   `className` **[string][89]** 
-   `isStatic` **[boolean][95]** 
-   `signature` **[string][89]** 

Returns **[function][92]** 

### WrenJS_getForeignClassAllocator

Returns a VM's foreign class allocator to C.

#### Parameters

-   `id` **[number][91]** 
-   `module` **[string][89]** 
-   `className` **[string][89]** 

Returns **[function][92]** 

### WrenJS_getForeignClassFinalizer

Returns a VM's foreign class finalizer(destructor) to C.

#### Parameters

-   `id` **[number][91]** 
-   `module` **[string][89]** 
-   `className` **[string][89]** 

Returns **[function][92]** 

### WrenJS_isFileAvailable

Returns whether or not a file has been defined as a wren script in the document's head.
This is not used if WrenJS+ was built with ALLOW_NONSCRIPT_FETCH.

#### Parameters

-   `file` **[string][89]** 

Returns **[boolean][95]** 

### WrenJS_importFileFromVM

Requests a VM-defined result for a Wren import statement.
This is not used if WrenJS+ was built with DISABLE_JSVM_IMPORT.

#### Parameters

-   `vm` **[number][91]** 
-   `file` **[string][89]** 
-   `return_string` **[number][91]** 
-   `return_bytes` **[number][91]** 

[1]: #wrenvm

[2]: #examples

[3]: #interpret

[4]: #parameters

[5]: #examples-1

[6]: #call

[7]: #parameters-1

[8]: #examples-2

[9]: #free

[10]: #addforeignmethod

[11]: #parameters-2

[12]: #examples-3

[13]: #addforeignclassmethods

[14]: #parameters-3

[15]: #examples-4

[16]: #ensureslots

[17]: #parameters-4

[18]: #getslotcount

[19]: #getslottype

[20]: #parameters-5

[21]: #getslotdouble

[22]: #parameters-6

[23]: #setslotdouble

[24]: #parameters-7

[25]: #getslotstring

[26]: #parameters-8

[27]: #setslotstring

[28]: #parameters-9

[29]: #getslotbytes

[30]: #parameters-10

[31]: #setslotbytes

[32]: #parameters-11

[33]: #getslotbool

[34]: #parameters-12

[35]: #setslotbool

[36]: #parameters-13

[37]: #setslotnull

[38]: #parameters-14

[39]: #getslotforeign

[40]: #parameters-15

[41]: #setslotnewforeign

[42]: #parameters-16

[43]: #setslotnewlist

[44]: #parameters-17

[45]: #getlistcount

[46]: #parameters-18

[47]: #getlistelement

[48]: #parameters-19

[49]: #insertinlist

[50]: #parameters-20

[51]: #getvariable

[52]: #parameters-21

[53]: #getslothandle

[54]: #parameters-22

[55]: #setslothandle

[56]: #parameters-23

[57]: #makecallhandle

[58]: #parameters-24

[59]: #examples-5

[60]: #releasehandle

[61]: #parameters-25

[62]: #collectgarbage

[63]: #abortfiber

[64]: #parameters-26

[65]: #importfile

[66]: #parameters-27

[67]: #examples-6

[68]: #importfiles

[69]: #parameters-28

[70]: #examples-7

[71]: #wrenjs

[72]: #newvm

[73]: #parameters-29

[74]: #librarywren

[75]: #wrenjs_errorfn

[76]: #parameters-30

[77]: #wrenjs_writefn

[78]: #parameters-31

[79]: #wrenjs_getforeignmethod

[80]: #parameters-32

[81]: #wrenjs_getforeignclassallocator

[82]: #parameters-33

[83]: #wrenjs_getforeignclassfinalizer

[84]: #parameters-34

[85]: #wrenjs_isfileavailable

[86]: #parameters-35

[87]: #wrenjs_importfilefromvm

[88]: #parameters-36

[89]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[90]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[91]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[92]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[93]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array

[94]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/TypedArray

[95]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[96]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[97]: https://emscripten.org/docs/api_reference/preamble.js.html

[98]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[99]: #wrenvm
